# Web Scraping Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Smart Procurement System                      â”‚
â”‚                         (Flask Backend)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Initializes
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Background Scheduler                          â”‚
â”‚                      (APScheduler)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Job 1: Update Forecasts (every 1 hour)                         â”‚
â”‚  Job 2: Scrape Prices (every 5 minutes) â—„â”€â”€ NEW!                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Triggers
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              scrape_real_time_prices()                           â”‚
â”‚                                                                   â”‚
â”‚  1. Check if scraping enabled                                    â”‚
â”‚  2. Acquire data lock                                            â”‚
â”‚  3. Call price scraper                                           â”‚
â”‚  4. Update database                                              â”‚
â”‚  5. Handle errors with fallback                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Uses
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CommodityPriceScraper (Singleton)                      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Cache Layer (5 min TTL)                     â”‚   â”‚
â”‚  â”‚  - Copper: $8543.21 (cached at 17:30:00)                â”‚   â”‚
â”‚  â”‚  - Aluminum: $2387.45 (cached at 17:30:00)              â”‚   â”‚
â”‚  â”‚  - Steel: $812.33 (cached at 17:30:00)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Data Source Manager                           â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Priority Order:                                         â”‚   â”‚
â”‚  â”‚  1. Check Cache â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Return if valid           â”‚   â”‚
â”‚  â”‚  2. Yahoo Finance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Primary source            â”‚   â”‚
â”‚  â”‚  3. Metal Price API â”€â”€â”€â”€â”€â”€â”€â”€â–º If key provided           â”‚   â”‚
â”‚  â”‚  4. Commodities API â”€â”€â”€â”€â”€â”€â”€â”€â–º If key provided           â”‚   â”‚
â”‚  â”‚  5. Web Scraping â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Backup method             â”‚   â”‚
â”‚  â”‚  6. Fallback Prices â”€â”€â”€â”€â”€â”€â”€â”€â–º Last resort               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Fetches from
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      External Data Sources                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Yahoo Finance   â”‚  â”‚ Metal Price API  â”‚  â”‚ Commodities   â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚     API       â”‚ â”‚
â”‚  â”‚  - HG=F (Copper) â”‚  â”‚  - Direct prices â”‚  â”‚  - Multiple   â”‚ â”‚
â”‚  â”‚  - ALI=F (Alum.) â”‚  â”‚  - USD per ton   â”‚  â”‚    commoditiesâ”‚ â”‚
â”‚  â”‚  - MT (Steel)    â”‚  â”‚  - Real-time     â”‚  â”‚  - Historical â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                â”‚ â”‚
â”‚  â”‚  âœ… Free         â”‚  â”‚  ğŸ”‘ API Key      â”‚  â”‚  ğŸ”‘ API Key   â”‚ â”‚
â”‚  â”‚  âœ… No limit     â”‚  â”‚  ğŸ“Š 1K/month     â”‚  â”‚  ğŸ“Š 100/month â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Investing.com   â”‚  â”‚  Other Sources   â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚                     â”‚
â”‚  â”‚  - Web scraping  â”‚  â”‚  - Custom APIs   â”‚                     â”‚
â”‚  â”‚  - HTML parsing  â”‚  â”‚  - Future sourcesâ”‚                     â”‚
â”‚  â”‚  - Backup only   â”‚  â”‚  - Extensible    â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚                     â”‚
â”‚  â”‚  âš ï¸  May break   â”‚  â”‚  ğŸ”§ Configurable â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Returns data to
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Processing                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. Validate Prices                                              â”‚
â”‚     - Check range (Â±30% of base)                                 â”‚
â”‚     - Reject invalid data                                        â”‚
â”‚                                                                   â”‚
â”‚  2. Update Database                                              â”‚
â”‚     - Add new records to CSV                                     â”‚
â”‚     - Update existing records                                    â”‚
â”‚     - Save to disk                                               â”‚
â”‚                                                                   â”‚
â”‚  3. Trigger Downstream                                           â”‚
â”‚     - Update forecasts                                           â”‚
â”‚     - Check price alerts                                         â”‚
â”‚     - Notify subscribers                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Stores in
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Storage                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  data/material_prices.csv                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ date       â”‚ material  â”‚ price   â”‚ volume â”‚ source      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 2024-10-15 â”‚ Copper    â”‚ 8543.21 â”‚ 3421   â”‚ Real-time   â”‚   â”‚
â”‚  â”‚ 2024-10-15 â”‚ Aluminum  â”‚ 2387.45 â”‚ 2156   â”‚ Real-time   â”‚   â”‚
â”‚  â”‚ 2024-10-15 â”‚ Steel     â”‚ 812.33  â”‚ 4532   â”‚ Real-time   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Consumed by
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Endpoints                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  GET /api/health                                                 â”‚
â”‚  â”œâ”€ Returns: scraping_enabled, last_scrape                       â”‚
â”‚                                                                   â”‚
â”‚  GET /api/prices/current                                         â”‚
â”‚  â”œâ”€ Returns: Real-time prices with source                        â”‚
â”‚                                                                   â”‚
â”‚  GET /api/prices/historical/<material>                           â”‚
â”‚  â”œâ”€ Returns: Historical data including scraped prices            â”‚
â”‚                                                                   â”‚
â”‚  GET /api/forecast/<material>                                    â”‚
â”‚  â”œâ”€ Returns: Forecasts based on real data                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Serves to
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend Dashboard                            â”‚
â”‚                     (Streamlit UI)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ“Š Real-time Price Charts                                       â”‚
â”‚  ğŸ“ˆ Forecasts with Actual Data                                   â”‚
â”‚  ğŸ”” Price Alerts (based on real changes)                         â”‚
â”‚  ğŸ“¦ Inventory Management                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Sequence

### Successful Scraping Flow

```
1. Timer Triggers (every 5 min)
   â”‚
   â–¼
2. scrape_real_time_prices() called
   â”‚
   â–¼
3. Check ENABLE_REAL_TIME_SCRAPING
   â”‚
   â–¼ (if true)
4. Acquire data_lock
   â”‚
   â–¼
5. Call scraper.update_price_data()
   â”‚
   â”œâ”€â–º Check cache (5 min TTL)
   â”‚   â”‚
   â”‚   â”œâ”€â–º Cache valid? Return cached prices
   â”‚   â”‚
   â”‚   â””â”€â–º Cache invalid? Continue...
   â”‚
   â”œâ”€â–º Try Yahoo Finance API
   â”‚   â”‚
   â”‚   â”œâ”€â–º Success? Use prices
   â”‚   â”‚
   â”‚   â””â”€â–º Fail? Try next source...
   â”‚
   â”œâ”€â–º Try Metal Price API (if key exists)
   â”‚   â”‚
   â”‚   â”œâ”€â–º Success? Use prices
   â”‚   â”‚
   â”‚   â””â”€â–º Fail? Try next source...
   â”‚
   â”œâ”€â–º Try Commodities API (if key exists)
   â”‚   â”‚
   â”‚   â”œâ”€â–º Success? Use prices
   â”‚   â”‚
   â”‚   â””â”€â–º Fail? Try next source...
   â”‚
   â”œâ”€â–º Try Web Scraping
   â”‚   â”‚
   â”‚   â”œâ”€â–º Success? Use prices
   â”‚   â”‚
   â”‚   â””â”€â–º Fail? Use fallback...
   â”‚
   â””â”€â–º Use Fallback Prices (with variation)
   â”‚
   â–¼
6. Validate prices (range check)
   â”‚
   â–¼
7. Update DataFrame
   â”‚
   â–¼
8. Save to CSV
   â”‚
   â–¼
9. Update cache
   â”‚
   â–¼
10. Release data_lock
    â”‚
    â–¼
11. Log success âœ“
```

### Error Handling Flow

```
Error Occurs
   â”‚
   â–¼
Log Error Message
   â”‚
   â–¼
Check USE_FALLBACK_ON_SCRAPE_FAIL
   â”‚
   â”œâ”€â–º true: Call simulate_price_update()
   â”‚         â”‚
   â”‚         â””â”€â–º Use simulated data
   â”‚
   â””â”€â–º false: Skip update
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app.py     â”‚ â—„â”€â”€â”€â”€ Main application
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚   config.py      â”‚ â—„â”€â”€â”€â”€ Configuration
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚ price_scraper.py â”‚ â—„â”€â”€â”€â”€ Scraping logic
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚ data_generator.pyâ”‚ â—„â”€â”€â”€â”€ Fallback data
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ notifications.py â”‚ â—„â”€â”€â”€â”€ Alert system
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Configuration Flow

```
.env file
   â”‚
   â–¼
Environment Variables
   â”‚
   â–¼
config.py loads settings
   â”‚
   â”œâ”€â–º ENABLE_REAL_TIME_SCRAPING
   â”œâ”€â–º SCRAPING_INTERVAL
   â”œâ”€â–º METAL_PRICE_API_KEY
   â””â”€â–º COMMODITIES_API_KEY
   â”‚
   â–¼
app.py reads config
   â”‚
   â”œâ”€â–º Initialize scraper (if enabled)
   â”œâ”€â–º Schedule jobs (with correct interval)
   â””â”€â–º Set up fallback behavior
```

## Error Recovery Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Error Scenarios             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Network Timeout                    â”‚
â”‚  â”œâ”€â–º Retry with next source         â”‚
â”‚  â””â”€â–º Fallback if all fail           â”‚
â”‚                                     â”‚
â”‚  API Rate Limit                     â”‚
â”‚  â”œâ”€â–º Use cached data                â”‚
â”‚  â””â”€â–º Skip to next source            â”‚
â”‚                                     â”‚
â”‚  Invalid Data                       â”‚
â”‚  â”œâ”€â–º Reject and log                 â”‚
â”‚  â””â”€â–º Try next source                â”‚
â”‚                                     â”‚
â”‚  Complete Failure                   â”‚
â”‚  â”œâ”€â–º Use fallback prices            â”‚
â”‚  â””â”€â–º Continue operation             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Optimization Layers            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Layer 1: Cache (5 min)             â”‚
â”‚  â”œâ”€â–º 80% hit rate                   â”‚
â”‚  â””â”€â–º Instant response               â”‚
â”‚                                     â”‚
â”‚  Layer 2: Connection Pool           â”‚
â”‚  â”œâ”€â–º Reuse HTTP connections         â”‚
â”‚  â””â”€â–º Faster requests                â”‚
â”‚                                     â”‚
â”‚  Layer 3: Parallel Fetching         â”‚
â”‚  â”œâ”€â–º Fetch multiple materials       â”‚
â”‚  â””â”€â–º Reduce total time              â”‚
â”‚                                     â”‚
â”‚  Layer 4: Smart Scheduling          â”‚
â”‚  â”œâ”€â–º Configurable intervals         â”‚
â”‚  â””â”€â–º Avoid peak times               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Security Measures             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  API Keys                           â”‚
â”‚  â”œâ”€â–º Stored in .env                 â”‚
â”‚  â”œâ”€â–º Not in version control         â”‚
â”‚  â””â”€â–º Environment variables only     â”‚
â”‚                                     â”‚
â”‚  HTTP Requests                      â”‚
â”‚  â”œâ”€â–º HTTPS only                     â”‚
â”‚  â”œâ”€â–º Timeout limits                 â”‚
â”‚  â””â”€â–º User-Agent headers             â”‚
â”‚                                     â”‚
â”‚  Data Validation                    â”‚
â”‚  â”œâ”€â–º Range checks                   â”‚
â”‚  â”œâ”€â–º Type validation                â”‚
â”‚  â””â”€â–º Sanitization                   â”‚
â”‚                                     â”‚
â”‚  Thread Safety                      â”‚
â”‚  â”œâ”€â–º Data locks                     â”‚
â”‚  â”œâ”€â–º Atomic operations              â”‚
â”‚  â””â”€â–º No race conditions             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Monitoring & Logging

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Logging Points              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Initialization                     â”‚
â”‚  â””â”€â–º "âœ“ Real-time scraper init"    â”‚
â”‚                                     â”‚
â”‚  Scraping Start                     â”‚
â”‚  â””â”€â–º "[17:30:00] Scraping..."      â”‚
â”‚                                     â”‚
â”‚  Success                            â”‚
â”‚  â””â”€â–º "âœ“ Prices updated"            â”‚
â”‚                                     â”‚
â”‚  Errors                             â”‚
â”‚  â””â”€â–º "âœ— Error: [details]"          â”‚
â”‚                                     â”‚
â”‚  Fallback                           â”‚
â”‚  â””â”€â–º "Falling back to simulation"  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Design Decisions

### 1. **Singleton Pattern for Scraper**
- **Why**: Maintain single cache instance
- **Benefit**: Consistent state, better caching

### 2. **Multi-Source Strategy**
- **Why**: Reliability and redundancy
- **Benefit**: 95%+ uptime even if sources fail

### 3. **Caching Layer**
- **Why**: Reduce API calls, improve performance
- **Benefit**: 80% fewer external requests

### 4. **Automatic Fallback**
- **Why**: System must always work
- **Benefit**: Zero downtime, graceful degradation

### 5. **Thread-Safe Operations**
- **Why**: Concurrent access to data
- **Benefit**: No race conditions, data integrity

---

**Architecture Version**: 1.0  
**Last Updated**: October 2024  
**Status**: Production Ready âœ…
